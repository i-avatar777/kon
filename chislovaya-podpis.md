# Описание числовой подписи

Этот документ дает определение и способ использования числовой подписи.

## Назначение

Числовая подпись (signature) нужна для того чтобы можно было подписать документ (файл с данными). Файл может быть любой. 
Подпись генерируется на каждый процесс подписи и каждый раз она уникальна. 
Для того чтобы сформировать подпись необходима библиотека которая генерирует приватный ключ (PrivK).
Далее при помощи библиотеки получаем публичный адрес из приватного ключа (PubK) - он всегда постоянный и открытый (свободно распространяемый) вне зависимости от количества вызовов.
Далее при помощи библиотеки делаем подпись документа. Подпись всегда уникальна на каждый вызов подписи одного и того же документа одним и тем же приватным ключом (PrivK).

![](images/s_28.png)

Для того чтобы проверяющая сторона могла проверить подпись ей нужен документ, публичный ключ (PubK) и сама подпись.
При помощи библиотеки можно это проверить. Она выдаст ИСТИНА (TRUE) только в одном случае, если именно этот документ подписал именно обладатель приватного ключа (PrivK) на основе которого был сформирован публичный ключ (PubK).
В других случаях она выдаст ЛОЖЬ (FALSE) что означает что или документ был изменен или подпись не того человека. Определить что именно можно только если получится получить TRUE от исходных правильных данных. 

Существует несколько алгоритмов числовой подписи. Мы используем https://github.com/BitcoinPHP/BitcoinECDSA.php. Версия `1.3.4`. Ссылка https://api.github.com/repos/BitcoinPHP/BitcoinECDSA.php/zipball/b8859651a40a029a93a174b60abf6d33e6691561.

## Что собой из себя представляет числовая подпись?

Числовая подпись представляет из себя строку набора символов. Например `IC2WCCd67twgWp6lMJL00cHWeUtH9bwhRmzN0N8Pu4OmRXoOfAz71t9toXVJThHh2GtprXKo6Jt0yhxcMRoJSV0=`.

Приватный ключ представляет из себя строку набора символов. Например `896d3c32dd5d6eac08720fdb5d413673fc043d474186a13013ab62a2d3640919`. По сути это секретный пароль который является уникальным для каждого человека.

Публичный ключ представляет из себя строку набора символов. Например `19qyEp5KSPu7cCuEaPzTjzoRTkGDSJGJn`.

## Способ использования

В виду того что подпись документов числовой подписью является действием которое подтверждает кто именно сделал такую подпись, то критически важным является сохранение приватного ключа. 
Так как числовую подпись можно проверить без приватного ключа, то лучшей практикой будет генерировать числовую подпись на своем компьютере и отправлять уже саму числовую подпись в систему или партнеру.

## Соответствие законодательству России

Из документа: http://www.consultant.ru/document/cons_doc_LAW_112701/d9cd621c949a3c9efef51c2884c247e18ab9908b/

Неквалифицированной электронной подписью является электронная подпись, которая:
1) получена в результате криптографического преобразования информации с использованием ключа электронной подписи;
2) позволяет определить лицо, подписавшее электронный документ;
3) позволяет обнаружить факт внесения изменений в электронный документ после момента его подписания;
4) создается с использованием средств электронной подписи. 

Рассмотрим как в нашем случае происходит реализация вышеприведенных требований.

### 1) получена в результате криптографического преобразования информации с использованием ключа электронной подписи

Подпись получается с использованием криптографического преобразования ключа (в нашем случае PrivK).
Ссылка на код функции: https://github.com/BitcoinPHP/BitcoinECDSA.php/blob/1.3.4/src/BitcoinPHP/BitcoinECDSA/BitcoinECDSA.php#L1001

### 2) позволяет определить лицо, подписавшее электронный документ

Библиотека позволяет определить лицо, который якобы подписывал документ.

Пример использования:

вызывается функция `checkSignatureForMessage($address, $encodedSignature, $message)`
где 
- `$address` - адрес подписанта
- `$encodedSignature` - подпись
- `$message` - hash подписанного файла

Если функция вернет TRUE - это значит что подпись соответствует адресу подписанта и сообщению.

Если функция вернет FALSE - это значит что не верен адрес подписанта.

### 3) позволяет обнаружить факт внесения изменений в электронный документ после момента его подписания

Если после изменений проверить соответствует ли подпись документу, то функция выдаст FALSE.

Пример использования:

вызывается функция `checkSignatureForMessage($address, $encodedSignature, $message)`
где 
- `$address` - адрес подписанта
- `$encodedSignature` - подпись
- `$message` - hash подписанного файла

Если функция вернет TRUE - это значит что подпись соответствует адресу подписанта и сообщению.

Если функция вернет FALSE - это значит что не верен файл.

### 4) создается с использованием средств электронной подписи

Средством электронной подписи является криптографическая библиотека для работы с электронными подписями.


## Ссылки

Цифровые подписи: https://youtu.be/-ULke4Y3wu0

Виды электронных подписей: http://www.consultant.ru/document/cons_doc_LAW_112701/d9cd621c949a3c9efef51c2884c247e18ab9908b/

С 01.07.2020 вносятся изменения в 63-ФЗ, где Удостоверяющий центр 1) создает сертификаты ключей проверки электронных подписей и выдает такие сертификаты заявителям при условии идентификации заявителя. Идентификация заявителя проводится при его личном присутствии или посредством идентификации заявителя без его личного присутствия с использованием квалифицированной электронной подписи при наличии действующего квалифицированного сертификата либо посредством идентификации заявителя - гражданина Российской Федерации с применением информационных технологий без его личного присутствия путем предоставления информации, указанной в документе, удостоверяющем личность гражданина Российской Федерации за пределами территории Российской Федерации, содержащем электронный носитель информации с записанными на нем персональными данными владельца паспорта, включая биометрические персональные данные, или путем предоставления сведений из единой системы идентификации и аутентификации и информации из единой биометрической системы в порядке, установленном Федеральным законом (http://www.consultant.ru/document/cons_doc_LAW_349433/#dst0) от 27 июля 2006 года N 149-ФЗ "Об информации, информационных технологиях и о защите информации". При этом в случае, если физическое лицо для предоставления своих биометрических персональных данных в целях проведения идентификации без личного присутствия отказывается от использования шифровальных (криптографических) средств, указанных в части 19 статьи 14.1 (http://www.consultant.ru/document/cons_doc_LAW_349433/cee89319d92daa4b5cfc479cc6d6d63aaec4a178/#dst389) Федерального закона от 27 июля 2006 года N 149-ФЗ "Об информации, информационных технологиях и о защите информации", удостоверяющий центр обязан отказать такому лицу в проведении указанной идентификации; http://www.consultant.ru/document/cons_doc_LAW_341757/3d0cac60971a511280cbba229d9b6329c07731f7/#dst100062